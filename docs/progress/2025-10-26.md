# 2025-10-26 開発メモ

## 実装済みハイライト
- **自動保存クラッシュ復旧強化**: 起動時の復旧モーダル、正式保存時の `metadata.autosave` 削除、保存後の自動保存ファイル削除を実装。保存成功/失敗時にトースト通知が表示されるようになりました。
- **性能ベンチマーク自動化**: `npm run bench:preview:full` で FastAPI 起動→Electron ベンチ実行→ログ集計→`docs/benchmarks/latest.md` 更新→履歴保存→Markdown/HTML サマリー生成まで自動化。
- **ベンチ履歴整備**: `docs/benchmarks/history/` にタイムスタンプ付き履歴と、Chart.js による可視化 (`summary.html`) を生成。Markdown (`summary.md`) にはプロファイル別の統計値（平均・最小・最大・標準偏差・最新日時）を追記。
- **テスト・CI**: 
  - `tests/renderer/autosave.test.ts` で `stripAutosaveMetadata` の回帰テストを追加。
  - `.github/workflows/ci.yml` を作成し、`npm ci → npm test → npm run bench:preview:history` を実行して `summary.md`/`summary.html` をアーティファクトとしてアップロード。
- **UI プレビュー**: `npm run toast:preview` で `docs/ui/toast-preview.html` を生成し、保存トーストの挙動を単体確認できるようにした。

## 主なコマンド
```bash
# 単体テスト
npm run test

# プレビュー計測一括実行（ログ/履歴/HTML 更新）
npm run bench:preview:full

# 履歴サマリー再集計のみ
npm run bench:preview:history

# トースト UI プレビューの生成
tnpm run toast:preview
```

## 新規/更新ファイル
- `src/renderer/utils/autosave.ts`（`stripAutosaveMetadata`, `cloneProject`）
- `src/renderer/App.tsx`（保存フローのトースト通知・自動保存クリーンアップ）
- `src/renderer/styles.css`（トーストスタイル）
- `scripts/benchmarks/run_preview_bench.mjs` / `summarize_history.mjs`
- `docs/benchmarks/history/summary.md`, `summary.html`
- `scripts/ui/generate_toast_preview.mjs`, `docs/ui/toast-preview.html`
- `.github/workflows/ci.yml`
- `tests/renderer/autosave.test.ts`

## 次回以降の TODO
1. **ベンチレポート公開整備**: `summary.html` を GitHub Pages などでホストし、CI から自動公開 or PR コメントにプレビューリンクを貼れるようにする。
2. **トースト UX のさらなる検証**: Storybook 導入や E2E テストで保存トーストの表示タイミングを再現。
3. **ベンチ統計の拡張**: 履歴の多角的分析（例えば閾値超過の自動通知など）や古い履歴のローテーション方針を決める。

## 参考
- `docs/benchmarks/history/summary.html`（計測推移グラフ）
- `docs/ui/toast-preview.html`（保存トーストプレビュー）
