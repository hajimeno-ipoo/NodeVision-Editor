# 2025-11-01 進捗ログ

## 全体サマリ
- プレビュー再生成のハッシュ処理をユーティリティ化し、Vitest で網羅テストを追加。カバレッジ 97% 超を維持。
- ノードカタログ API に `description` / `defaultParams` / `defaultInputs` / `defaultOutputs` を追加し、Resize / Crop / Blend ノードをバックエンドに実装。
- フロントのカタログ表示とノード追加フローをリッチ化。説明文と推奨出力を表示し、デフォルト値をそのままノードへ適用するよう改善。
- プレビュー HUD にノード数とパイプライン概要（先頭 6 ノードまで）を表示。タイムスタンプは `Asia/Tokyo` タイムゾーンへ統一。
- direnv を導入して `.envrc` を整備。プロジェクトへ移動するだけで `.venv` が自動アクティベートされるようにした。

## 実装ハイライト
- `backend/app/main.py`
  - `NodeCatalogItem` に説明文とデフォルト入出力を追加。
  - Resize / Crop / Blend の画像処理ロジックを追加（Pillowベース）。
  - プレビュー生成レスポンスの時刻を `datetime.now(ZoneInfo("Asia/Tokyo"))` に変更し HUD にパイプライン概要を表示。
- `docs/event_protocol.md`
  - `/nodes/catalog` の追加フィールドと新ノードを記録。
- `src/renderer`
  - `utils/catalog-defaults.ts` でカタログデフォルトを正規化。
  - `App.tsx` から新ヘルパーを利用し、UI 表示とノード生成に反映。
- `backend/tests/test_project_load.py` へ画像処理ノードを含む保存→再読込のシナリオを追加。
- `backend/tests/test_image_nodes.py`（FastAPI 環境では有効）で Resize→Crop→Blend→Preview のパイプラインを検証。
- `.envrc` + `~/.zshrc` を更新し direnv で自動的に `.venv` が読み込まれる構成を整備。

## 次回以降の TODO
1. プレビュー再生成トリガー（ノード編集・自動保存・復旧など）を再点検し、抜け漏れがあればフロント側にイベントを追加。
2. 画像処理ノードを含む `.nveproj` サンプルと vitest/unittest をセットで整備し、保存→再読込→プレビューまでの回帰テストを自動化。
3. `scripts/benchmarks` 系を再実行して `docs/benchmarks/history` を更新。新パイプラインの指標を HUD と進捗ログに反映。
4. Resize/Crop/Blend ノードの UI 設定項目（比率固定やクリッピング座標）を画面上で編集できるようフォームを整備。
5. Preview HUD のタイムスタンプは JST 表示になったので、必要に応じて UTC との併記や表示形式をドキュメントへ追記。
